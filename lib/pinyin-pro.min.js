/**
 * 简化版拼音转换库 - 专为QuickFinder优化
 * 支持常用汉字的拼音转换
 */
(function(global) {
  'use strict';

  // 常用汉字拼音映射表
  const PINYIN_MAP = {
  // 基础高频字（新增部分）
  '们': 'men', '得': 'de', '说': 'shuo', '话': 'hua', '都': 'dou', 
  '把': 'ba', '被': 'bei', '从': 'cong', '自': 'zi', '到': 'dao',
  '当': 'dang', '在': 'zai', '所': 'suo', '以': 'yi', '可': 'ke',
  '爱': 'ai', '没': 'mei', '看': 'kan', '听': 'ting', '闻': 'wen',
  
  // 时间与日期（新增）
  '春': 'chun', '夏': 'xia', '秋': 'qiu', '冬': 'dong',
  '周': 'zhou', '季': 'ji', '晨': 'chen', '昏': 'hun', '昼': 'zhou',
  '夜': 'ye', '秒': 'miao', '刻': 'ke', '钟': 'zhong', '点': 'dian',
  
  // 方位与空间（新增）
  '顶': 'ding', '底': 'di', '间': 'jian', '旁': 'pang', '角': 'jiao',
  '内': 'nei', '外': 'wai', '中': 'zhong', '心': 'xin', '侧': 'ce',
  '竖': 'shu', '横': 'heng', '斜': 'xie', '正': 'zheng', '偏': 'pian',
  
  // 动作与行为（新增）
  '抱': 'bao', '背': 'bei', '踩': 'cai', '跳': 'tiao', '踢': 'ti',
  '摸': 'mo', '捏': 'nie', '拍': 'pai', '捧': 'peng', '扔': 'reng',
  '写': 'xie', '画': 'hua', '读': 'du', '算': 'suan', '记': 'ji',
  
  // 情感与状态（新增）
  '喜': 'xi', '怒': 'nu', '哀': 'ai', '乐': 'le', '忧': 'you',
  '惊': 'jing', '恐': 'kong', '悲': 'bei', '欢': 'huan', '愁': 'chou',
  '忙': 'mang', '闲': 'xian', '累': 'lei', '懒': 'lan', '勤': 'qin',
  
  // 自然与环境（新增）
  '天': 'tian', '地': 'di', '日': 'ri', '月': 'yue', '星': 'xing',
  '云': 'yun', '雨': 'yu', '雪': 'xue', '风': 'feng', '雷': 'lei',
  '电': 'dian', '山': 'shan', '水': 'shui', '河': 'he', '湖': 'hu',
  '海': 'hai', '林': 'lin', '木': 'mu', '花': 'hua', '草': 'cao',
  
  // 颜色与形状（新增）
  '棕': 'zong', '橙': 'cheng', '青': 'qing', '褐': 'he', '彩': 'cai',
  '圆': 'yuan', '方': 'fang', '三角': 'sanjiao', '椭圆': 'tuoyuan',
  '尖': 'jian', '钝': 'dun', '弯': 'wan', '直': 'zhi', '凸': 'tu',
  '凹': 'ao', '平': 'ping', '皱': 'zhou', '滑': 'hua', '糙': 'cao',
  
  // 身体与器官（新增）
  '头': 'tou', '脑': 'nao', '脸': 'lian', '眼': 'yan', '耳': 'er',
  '鼻': 'bi', '嘴': 'zui', '牙': 'ya', '舌': 'she', '颈': 'jing',
  '胸': 'xiong', '背': 'bei', '腹': 'fu', '腰': 'yao', '手': 'shou',
  '臂': 'bi', '腿': 'tui', '脚': 'jiao', '指': 'zhi', '趾': 'zhi',
  
  // 社会与文化（新增）
  '国': 'guo', '家': 'jia', '党': 'dang', '民': 'min', '族': 'zu',
  '学': 'xue', '校': 'xiao', '教': 'jiao', '师': 'shi', '生': 'sheng',
  '工': 'gong', '农': 'nong', '商': 'shang', '兵': 'bing', '科': 'ke',
  '技': 'ji', '文': 'wen', '艺': 'yi', '体': 'ti', '育': 'yu',
  
  // 科技与数字（新增）
  '数': 'shu', '字': 'zi', '符': 'fu', '号': 'hao', '密': 'mi',
  '码': 'ma', '网': 'wang', '络': 'luo', '电': 'dian', '脑': 'nao',
  '手': 'shou', '机': 'ji', '屏': 'ping', '幕': 'mu', '键': 'jian',
  '鼠': 'shu', '标': 'biao', '硬': 'ying', '件': 'jian', '软': 'ruan',
  
  // 餐饮与食品（新增）
  '米': 'mi', '面': 'mian', '饭': 'fan', '菜': 'cai', '汤': 'tang',
  '肉': 'rou', '鱼': 'yu', '蛋': 'dan', '奶': 'nai', '油': 'you',
  '盐': 'yan', '糖': 'tang', '醋': 'cu', '茶': 'cha', '酒': 'jiu',
  '饮': 'yin', '料': 'liao', '水': 'shui', '果': 'guo', '蔬': 'shu',
  
  // 交通与工具（新增）
  '车': 'che', '汽': 'qi', '火': 'huo', '飞': 'fei', '机': 'ji',
  '船': 'chuan', '舰': 'jian', '自': 'zi', '行': 'xing', '车': 'che',
  '公': 'gong', '交': 'jiao', '卡': 'ka', '票': 'piao', '站': 'zhan',
  '路': 'lu', '桥': 'qiao', '隧': 'sui', '道': 'dao', '灯': 'deng',
  
  // 原有关键字（保留）
  '中': 'zhong', '国': 'guo', '人': 'ren', '大': 'da', '小': 'xiao',
  '好': 'hao', '的': 'de', '是': 'shi', '在': 'zai', '有': 'you',
  '我': 'wo', '他': 'ta', '她': 'ta', '它': 'ta', '们': 'men',
  '这': 'zhe', '那': 'na', '个': 'ge', '了': 'le', '不': 'bu',
  '一': 'yi', '二': 'er', '三': 'san', '四': 'si', '五': 'wu',
  '六': 'liu', '七': 'qi', '八': 'ba', '九': 'jiu', '十': 'shi',
  '百': 'bai', '千': 'qian', '万': 'wan', '年': 'nian', '月': 'yue',
  '日': 'ri', '时': 'shi', '分': 'fen', '秒': 'miao', '上': 'shang',
  '下': 'xia', '左': 'zuo', '右': 'you', '前': 'qian', '后': 'hou',
  '东': 'dong', '南': 'nan', '西': 'xi', '北': 'bei', '中': 'zhong',
  '内': 'nei', '外': 'wai', '里': 'li', '面': 'mian', '边': 'bian',
  '来': 'lai', '去': 'qu', '到': 'dao', '从': 'cong', '向': 'xiang',
  '对': 'dui', '和': 'he', '与': 'yu', '及': 'ji', '以': 'yi',
  '为': 'wei', '被': 'bei', '把': 'ba', '让': 'rang', '使': 'shi',
  '得': 'de', '着': 'zhe', '过': 'guo', '起': 'qi', '开': 'kai',
  '关': 'guan', '打': 'da', '做': 'zuo', '说': 'shuo', '看': 'kan',
  '听': 'ting', '想': 'xiang', '知': 'zhi', '道': 'dao', '会': 'hui',
  '能': 'neng', '可': 'ke', '要': 'yao', '应': 'ying', '该': 'gai',
  '必': 'bi', '须': 'xu', '需': 'xu', '用': 'yong', '给': 'gei',
  '拿': 'na', '放': 'fang', '买': 'mai', '卖': 'mai', '吃': 'chi',
  '喝': 'he', '穿': 'chuan', '住': 'zhu', '行': 'xing', '走': 'zou',
  '跑': 'pao', '飞': 'fei', '游': 'you', '泳': 'yong', '学': 'xue',
  '习': 'xi', '工': 'gong', '作': 'zuo', '生': 'sheng', '活': 'huo',
  '家': 'jia', '庭': 'ting', '父': 'fu', '母': 'mu', '子': 'zi',
  '女': 'nv', '男': 'nan', '老': 'lao', '少': 'shao', '新': 'xin',
  '旧': 'jiu', '高': 'gao', '低': 'di', '长': 'chang', '短': 'duan',
  '宽': 'kuan', '窄': 'zhai', '厚': 'hou', '薄': 'bao', '重': 'zhong',
  '轻': 'qing', '快': 'kuai', '慢': 'man', '早': 'zao', '晚': 'wan',
  '多': 'duo', '少': 'shao', '全': 'quan', '半': 'ban', '空': 'kong',
  '满': 'man', '红': 'hong', '黄': 'huang', '蓝': 'lan', '绿': 'lv',
  '白': 'bai', '黑': 'hei', '灰': 'hui', '粉': 'fen', '紫': 'zi',
  '书': 'shu', '本': 'ben', '页': 'ye', '字': 'zi', '词': 'ci',
  '句': 'ju', '段': 'duan', '章': 'zhang', '文': 'wen', '章': 'zhang',
  '网': 'wang', '站': 'zhan', '页': 'ye', '面': 'mian', '链': 'lian',
  '接': 'jie', '地': 'di', '址': 'zhi', '搜': 'sou', '索': 'suo',
  '查': 'cha', '找': 'zhao', '发': 'fa', '现': 'xian', '结': 'jie',
  '果': 'guo', '信': 'xin', '息': 'xi', '数': 'shu', '据': 'ju',
  '文': 'wen', '件': 'jian', '图': 'tu', '片': 'pian', '视': 'shi',
  '频': 'pin', '音': 'yin', '乐': 'le', '电': 'dian', '影': 'ying',
  '游': 'you', '戏': 'xi', '软': 'ruan', '件': 'jian', '应': 'ying',
  '用': 'yong', '程': 'cheng', '序': 'xu', '系': 'xi', '统': 'tong',
  '设': 'she', '置': 'zhi', '配': 'pei', '置': 'zhi', '管': 'guan',
  '理': 'li', '员': 'yuan', '用': 'yong', '户': 'hu', '密': 'mi',
  '码': 'ma', '登': 'deng', '录': 'lu', '注': 'zhu', '册': 'ce',
  '退': 'tui', '出': 'chu', '保': 'bao', '存': 'cun', '删': 'shan',
  '除': 'chu', '修': 'xiu', '改': 'gai', '更': 'geng', '新': 'xin',
  '添': 'tian', '加': 'jia', '创': 'chuang', '建': 'jian', '编': 'bian',
  '辑': 'ji', '复': 'fu', '制': 'zhi', '粘': 'zhan', '贴': 'tie',
  '剪': 'jian', '切': 'qie', '撤': 'che', '销': 'xiao', '重': 'chong',
  '做': 'zuo', '确': 'que', '定': 'ding', '取': 'qu', '消': 'xiao',
  '帮': 'bang', '助': 'zhu', '关': 'guan', '于': 'yu', '版': 'ban',
  '权': 'quan', '联': 'lian', '系': 'xi', '反': 'fan', '馈': 'kui'
};

  // 拼音转换函数
  function pinyin(text, options = {}) {
    if (typeof text !== 'string') return [];
    
    const { 
      style = 'normal',  // normal, first, initials
      heteronym = false,  // 是否返回多音字
      segment = false     // 是否分词
    } = options;

    const result = [];
    
    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      
      if (PINYIN_MAP[char]) {
        const py = PINYIN_MAP[char];
        
        switch (style) {
          case 'first':
            result.push(py[0]); // 首字母
            break;
          case 'initials':
            result.push(getInitials(py)); // 声母
            break;
          default:
            result.push(py); // 完整拼音
        }
      } else if (/[a-zA-Z0-9]/.test(char)) {
        result.push(char.toLowerCase()); // 保留英文和数字
      } else if (/\s/.test(char)) {
        result.push(' '); // 保留空格
      }
      // 忽略其他字符
    }
    
    return result;
  }

  // 获取声母
  function getInitials(py) {
    const initials = ['zh', 'ch', 'sh', 'b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 'g', 'k', 'h', 'j', 'q', 'x', 'z', 'c', 's', 'r', 'y', 'w'];
    for (const initial of initials) {
      if (py.startsWith(initial)) {
        return initial;
      }
    }
    return py[0] || '';
  }

  // 检测是否包含中文
  function hasChinese(text) {
    return /[\u4e00-\u9fff]/.test(text);
  }

  // 生成搜索索引
  function generateSearchIndex(text) {
    if (!text || !hasChinese(text)) {
      return [text.toLowerCase()];
    }

    const indexes = new Set();
    
    // 原文
    indexes.add(text.toLowerCase());
    
    // 完整拼音
    const fullPinyin = pinyin(text).join('');
    if (fullPinyin) indexes.add(fullPinyin);
    
    // 首字母拼音
    const firstLetters = pinyin(text, { style: 'first' }).join('');
    if (firstLetters) indexes.add(firstLetters);
    
    // 分词拼音（简单实现）
    const words = text.split(/\s+/);
    words.forEach(word => {
      if (word && hasChinese(word)) {
        const wordPinyin = pinyin(word).join('');
        if (wordPinyin) indexes.add(wordPinyin);
        
        const wordFirstLetters = pinyin(word, { style: 'first' }).join('');
        if (wordFirstLetters) indexes.add(wordFirstLetters);
      }
    });
    
    return Array.from(indexes);
  }

  // 搜索匹配
  function searchMatch(query, indexes) {
    if (!query || !indexes) return false;
    
    const lowerQuery = query.toLowerCase();
    
    return indexes.some(index => {
      return index.includes(lowerQuery) || lowerQuery.includes(index);
    });
  }

  // 导出API
  const PinyinPro = {
    pinyin,
    hasChinese,
    generateSearchIndex,
    searchMatch,
    version: '1.0.0'
  };

  // 兼容不同模块系统
  if (typeof module !== 'undefined' && module.exports) {
    module.exports = PinyinPro;
  } else if (typeof define === 'function' && define.amd) {
    define(function() { return PinyinPro; });
  } else {
    global.PinyinPro = PinyinPro;
  }

})(typeof window !== 'undefined' ? window : this);
