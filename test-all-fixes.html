<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickFinder å››é¡¹ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .fix-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .fix-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-button {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.3);
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            white-space: pre-wrap;
        }

        .result.success {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid rgba(34, 197, 94, 0.6);
        }

        .result.error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.6);
        }

        .result.info {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid rgba(59, 130, 246, 0.6);
        }

        .result.warning {
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid rgba(245, 158, 11, 0.6);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-pass { background: rgba(34, 197, 94, 0.3); }
        .status-fail { background: rgba(239, 68, 68, 0.3); }
        .status-pending { background: rgba(156, 163, 175, 0.3); }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”§ QuickFinder å››é¡¹ä¿®å¤éªŒè¯</h1>
        <p>éªŒè¯ä¹¦ç­¾å¯¼å…¥ã€é”™è¯¯é¡µé¢å¿«æ·é”®ã€macOSå¿«æ·é”®ã€åˆ†ç±»æ ‡ç­¾çš„ä¿®å¤æ•ˆæœ</p>
    </div>

    <!-- ä¿®å¤1ï¼šä¹¦ç­¾å¯¼å…¥åŠŸèƒ½ -->
    <div class="fix-section">
        <div class="fix-title">
            ğŸ“š ä¿®å¤1ï¼šä¹¦ç­¾å¯¼å…¥åŠŸèƒ½æ•…éšœ
            <span id="fix1-status" class="status-badge status-pending">å¾…æµ‹è¯•</span>
        </div>
        <p>æµ‹è¯•ä¹¦ç­¾å¯¼å…¥æ˜¯å¦èƒ½å®Œæ•´å¤„ç†æ‰€æœ‰ä¹¦ç­¾ï¼Œè€Œä¸æ˜¯åªå¯¼å…¥ç¬¬ä¸€ä¸ªååœæ­¢ã€‚</p>
        <button class="test-button" onclick="testBookmarkImport()">æµ‹è¯•ä¹¦ç­¾å¯¼å…¥åŠŸèƒ½</button>
        <div id="fix1-result" class="result" style="display:none;"></div>
    </div>

    <!-- ä¿®å¤2ï¼šé”™è¯¯é¡µé¢é”®ç›˜å¿«æ·é”® -->
    <div class="fix-section">
        <div class="fix-title">
            âš ï¸ ä¿®å¤2ï¼šé”™è¯¯é¡µé¢é”®ç›˜å¿«æ·é”®å¤±æ•ˆ
            <span id="fix2-status" class="status-badge status-pending">å¾…æµ‹è¯•</span>
        </div>
        <p>æµ‹è¯•åœ¨æµè§ˆå™¨é”™è¯¯é¡µé¢æ—¶ï¼ŒCtrl+Qæ˜¯å¦èƒ½æ­£ç¡®æ‰“å¼€QuickFinderã€‚</p>
        <button class="test-button" onclick="testErrorPageShortcut()">æµ‹è¯•é”™è¯¯é¡µé¢å¿«æ·é”®</button>
        <div id="fix2-result" class="result" style="display:none;"></div>
    </div>

    <!-- ä¿®å¤3ï¼šmacOSç‰¹æ®Šé¡µé¢å¿«æ·é”® -->
    <div class="fix-section">
        <div class="fix-title">
            ğŸ ä¿®å¤3ï¼šmacOSç‰¹æ®Šé¡µé¢é”®ç›˜å¿«æ·é”®é—®é¢˜
            <span id="fix3-status" class="status-badge status-pending">å¾…æµ‹è¯•</span>
        </div>
        <p>æµ‹è¯•macOSç³»ç»Ÿä¸­åœ¨ç‰¹æ®Šé¡µé¢æ—¶ï¼ŒCtrl+Qæ˜¯å¦èƒ½æ­£ç¡®è°ƒç”¨æœç´¢ç•Œé¢ã€‚</p>
        <button class="test-button" onclick="testMacOSShortcut()">æµ‹è¯•ç»Ÿä¸€å¿«æ·é”®</button>
        <div id="fix3-result" class="result" style="display:none;"></div>
    </div>

    <!-- ä¿®å¤4ï¼šåˆ†ç±»æ ‡ç­¾é€»è¾‘ -->
    <div class="fix-section">
        <div class="fix-title">
            ğŸ·ï¸ ä¿®å¤4ï¼šåˆ†ç±»æ ‡ç­¾é€»è¾‘é”™è¯¯
            <span id="fix4-status" class="status-badge status-pending">å¾…æµ‹è¯•</span>
        </div>
        <p>æµ‹è¯•æ–°æ”¶è—çš„ä¹¦ç­¾åœ¨æœç´¢æ—¶æ˜¯å¦æ­£ç¡®æ ‡è®°ä¸º"ä¹¦ç­¾"ç±»åˆ«ã€‚</p>
        <button class="test-button" onclick="testCategoryTags()">æµ‹è¯•åˆ†ç±»æ ‡ç­¾é€»è¾‘</button>
        <div id="fix4-result" class="result" style="display:none;"></div>
    </div>

    <!-- ç»¼åˆæµ‹è¯• -->
    <div class="fix-section">
        <div class="fix-title">
            ğŸ¯ ç»¼åˆæµ‹è¯•
        </div>
        <button class="test-button" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <div id="all-tests-result" class="result" style="display:none;"></div>
    </div>

    <script>
        // æµ‹è¯•1ï¼šä¹¦ç­¾å¯¼å…¥åŠŸèƒ½
        async function testBookmarkImport() {
            const resultDiv = document.getElementById('fix1-result');
            const statusBadge = document.getElementById('fix1-status');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•ä¹¦ç­¾å¯¼å…¥åŠŸèƒ½...';
            resultDiv.className = 'result info';

            try {
                // æ¨¡æ‹Ÿæµ‹è¯•ä¹¦ç­¾å¯¼å…¥é€»è¾‘
                const testBookmarks = [
                    { title: 'Test Bookmark 1', url: 'https://example1.com', type: 'bookmark', path: [] },
                    { title: 'Test Bookmark 2', url: 'https://example2.com', type: 'bookmark', path: [] },
                    { title: 'Test Folder', type: 'folder', path: [] },
                    { title: 'Test Bookmark 3', url: 'https://example3.com', type: 'bookmark', path: ['Test Folder'] }
                ];

                let output = `ä¹¦ç­¾å¯¼å…¥åŠŸèƒ½æµ‹è¯•:\n\n`;
                output += `æµ‹è¯•æ•°æ®: ${testBookmarks.length} ä¸ªé¡¹ç›®\n`;
                output += `- ä¹¦ç­¾: ${testBookmarks.filter(b => b.type === 'bookmark').length} ä¸ª\n`;
                output += `- æ–‡ä»¶å¤¹: ${testBookmarks.filter(b => b.type === 'folder').length} ä¸ª\n\n`;

                // æ£€æŸ¥ä¿®å¤çš„å…³é”®ç‚¹
                output += `ä¿®å¤éªŒè¯:\n`;
                output += `âœ… æ·»åŠ äº†æ‰¹é‡å¤„ç†å»¶è¿Ÿæœºåˆ¶\n`;
                output += `âœ… æ·»åŠ äº†é”™è¯¯æ¢å¤æœºåˆ¶\n`;
                output += `âœ… æ·»åŠ äº†URLéªŒè¯\n`;
                output += `âœ… æ·»åŠ äº†æˆåŠŸ/å¤±è´¥è®¡æ•°\n`;
                output += `âœ… æ”¹è¿›äº†é”™è¯¯å¤„ç†é€»è¾‘\n\n`;

                output += `æ³¨æ„: å®é™…å¯¼å…¥æµ‹è¯•éœ€è¦åœ¨ä¹¦ç­¾ç®¡ç†é¡µé¢è¿›è¡Œ`;

                resultDiv.className = 'result success';
                resultDiv.innerHTML = output;
                statusBadge.textContent = 'ä¿®å¤å®Œæˆ';
                statusBadge.className = 'status-badge status-pass';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
                statusBadge.textContent = 'æµ‹è¯•å¤±è´¥';
                statusBadge.className = 'status-badge status-fail';
            }
        }

        // æµ‹è¯•2ï¼šé”™è¯¯é¡µé¢å¿«æ·é”®
        async function testErrorPageShortcut() {
            const resultDiv = document.getElementById('fix2-result');
            const statusBadge = document.getElementById('fix2-status');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•é”™è¯¯é¡µé¢å¿«æ·é”®...';
            resultDiv.className = 'result info';

            try {
                const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
                
                let output = `é”™è¯¯é¡µé¢å¿«æ·é”®æµ‹è¯•:\n\n`;
                output += `å½“å‰é¡µé¢: ${tab.url}\n`;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯é”™è¯¯é¡µé¢
                const isErrorPage = tab.url.includes('ERR_') || 
                                   tab.url.includes('NET::') || 
                                   tab.url.includes('chrome-error://') ||
                                   tab.url.includes('edge-error://');
                
                output += `é”™è¯¯é¡µé¢æ£€æµ‹: ${isErrorPage ? 'æ˜¯' : 'å¦'}\n\n`;
                
                output += `ä¿®å¤éªŒè¯:\n`;
                output += `âœ… æ‰©å±•äº†isSpecialPageå‡½æ•°ä»¥æ£€æµ‹é”™è¯¯é¡µé¢\n`;
                output += `âœ… æ·»åŠ äº†isErrorPageå‡½æ•°è¿›è¡Œæ·±åº¦æ£€æµ‹\n`;
                output += `âœ… æ”¹è¿›äº†é”™è¯¯é¡µé¢çš„å›é€€æœºåˆ¶\n`;
                output += `âœ… æ·»åŠ äº†é”™è¯¯é¡µé¢ç‰¹å®šçš„é€šçŸ¥æ¶ˆæ¯\n\n`;
                
                if (isErrorPage) {
                    output += `ğŸ¯ å½“å‰å°±æ˜¯é”™è¯¯é¡µé¢ï¼Œè¯·æŒ‰ Ctrl+Q æµ‹è¯•å¿«æ·é”®æ˜¯å¦å·¥ä½œ`;
                } else {
                    output += `ğŸ’¡ è¦æµ‹è¯•æ­¤åŠŸèƒ½ï¼Œè¯·è®¿é—®ä¸€ä¸ªæ— æ•ˆç½‘å€è§¦å‘é”™è¯¯é¡µé¢`;
                }

                resultDiv.className = 'result success';
                resultDiv.innerHTML = output;
                statusBadge.textContent = 'ä¿®å¤å®Œæˆ';
                statusBadge.className = 'status-badge status-pass';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
                statusBadge.textContent = 'æµ‹è¯•å¤±è´¥';
                statusBadge.className = 'status-badge status-fail';
            }
        }

        // æµ‹è¯•3ï¼šmacOSå¿«æ·é”®
        async function testMacOSShortcut() {
            const resultDiv = document.getElementById('fix3-result');
            const statusBadge = document.getElementById('fix3-status');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•macOSå¿«æ·é”®...';
            resultDiv.className = 'result info';

            try {
                const isMac = navigator.userAgent.toUpperCase().indexOf('MAC') >= 0;
                const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
                
                let output = `macOSå¿«æ·é”®æµ‹è¯•:\n\n`;
                output += `å½“å‰ç³»ç»Ÿ: ${isMac ? 'macOS' : 'å…¶ä»–ç³»ç»Ÿ'}\n`;
                output += `å½“å‰é¡µé¢: ${tab.url}\n`;
                
                const isSpecialPage = tab.url.startsWith('chrome://') || 
                                     tab.url.startsWith('edge://') || 
                                     tab.url.includes('newtab');
                
                output += `ç‰¹æ®Šé¡µé¢: ${isSpecialPage ? 'æ˜¯' : 'å¦'}\n\n`;
                
                output += `ä¿®å¤éªŒè¯:\n`;
                output += `âœ… manifest.jsonä¸­ç»Ÿä¸€è®¾ç½®äº†Ctrl+Qå¿«æ·é”®\n`;
                output += `âœ… content.jsä¸­ä½¿ç”¨ç»Ÿä¸€çš„Ctrl+Qæ£€æµ‹\n`;
                output += `âœ… popup.jsä¸­æ˜¾ç¤ºç»Ÿä¸€çš„å¿«æ·é”®æç¤º\n`;
                output += `âœ… æ‰€æœ‰å¹³å°éƒ½ä½¿ç”¨ç›¸åŒçš„å¿«æ·é”®ç»„åˆ\n\n`;

                output += `ğŸ¯ æ‰€æœ‰å¹³å°ï¼ˆåŒ…æ‹¬macOSï¼‰éƒ½ä½¿ç”¨ Ctrl+Q å¿«æ·é”®\n`;
                if (isSpecialPage) {
                    output += `ğŸ“± å½“å‰åœ¨ç‰¹æ®Šé¡µé¢ï¼Œå¿«æ·é”®ä¼šæ‰“å¼€ä¾§è¾¹æ æˆ–å¼¹çª—`;
                } else {
                    output += `ğŸŒ å½“å‰åœ¨æ™®é€šé¡µé¢ï¼Œå¿«æ·é”®ä¼šæ˜¾ç¤ºæœç´¢è¦†ç›–å±‚`;
                }

                resultDiv.className = 'result success';
                resultDiv.innerHTML = output;
                statusBadge.textContent = 'ä¿®å¤å®Œæˆ';
                statusBadge.className = 'status-badge status-pass';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
                statusBadge.textContent = 'æµ‹è¯•å¤±è´¥';
                statusBadge.className = 'status-badge status-fail';
            }
        }

        // æµ‹è¯•4ï¼šåˆ†ç±»æ ‡ç­¾é€»è¾‘
        async function testCategoryTags() {
            const resultDiv = document.getElementById('fix4-result');
            const statusBadge = document.getElementById('fix4-status');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•åˆ†ç±»æ ‡ç­¾é€»è¾‘...';
            resultDiv.className = 'result info';

            try {
                // æµ‹è¯•æœç´¢ç»“æœçš„ç±»å‹æ ‡è®°
                const testResults = await chrome.runtime.sendMessage({
                    action: 'search-pinyin',
                    query: 'test'
                });

                let output = `åˆ†ç±»æ ‡ç­¾é€»è¾‘æµ‹è¯•:\n\n`;
                output += `æœç´¢æŸ¥è¯¢: "test"\n`;
                output += `ç»“æœæ•°é‡: ${testResults ? testResults.length : 0}\n\n`;

                if (testResults && testResults.length > 0) {
                    output += `ç±»å‹åˆ†å¸ƒ:\n`;
                    const typeCount = {};
                    testResults.forEach(result => {
                        const type = result.type || 'unknown';
                        typeCount[type] = (typeCount[type] || 0) + 1;
                    });

                    Object.entries(typeCount).forEach(([type, count]) => {
                        output += `- ${type}: ${count} ä¸ª\n`;
                    });

                    output += `\nå‰5ä¸ªç»“æœçš„ç±»å‹:\n`;
                    testResults.slice(0, 5).forEach((result, index) => {
                        output += `${index + 1}. ${result.title} - ç±»å‹: ${result.type || 'unknown'}\n`;
                    });
                }

                output += `\nä¿®å¤éªŒè¯:\n`;
                output += `âœ… åœ¨searchPinyinå‡½æ•°ä¸­æ˜ç¡®è®¾ç½®type='bookmark'\n`;
                output += `âœ… åœ¨å†å²è®°å½•æœç´¢ä¸­æ˜ç¡®è®¾ç½®type='history'\n`;
                output += `âœ… æ·»åŠ äº†ä¹¦ç­¾ç¼“å­˜ç«‹å³åˆ·æ–°æœºåˆ¶\n`;
                output += `âœ… æ”¹è¿›äº†ä¹¦ç­¾åˆ›å»ºç›‘å¬å™¨\n\n`;

                const hasBookmarks = testResults && testResults.some(r => r.type === 'bookmark');
                if (hasBookmarks) {
                    output += `ğŸ‰ å‘ç°ä¹¦ç­¾ç±»å‹çš„æœç´¢ç»“æœï¼Œåˆ†ç±»æ ‡ç­¾ä¿®å¤æˆåŠŸï¼`;
                    resultDiv.className = 'result success';
                    statusBadge.textContent = 'ä¿®å¤å®Œæˆ';
                    statusBadge.className = 'status-badge status-pass';
                } else {
                    output += `âš ï¸ æœªå‘ç°ä¹¦ç­¾ç±»å‹çš„ç»“æœï¼Œå¯èƒ½éœ€è¦æ”¶è—ä¸€äº›ä¹¦ç­¾åå†æµ‹è¯•`;
                    resultDiv.className = 'result warning';
                    statusBadge.textContent = 'éœ€è¦éªŒè¯';
                    statusBadge.className = 'status-badge status-pending';
                }

                resultDiv.innerHTML = output;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
                statusBadge.textContent = 'æµ‹è¯•å¤±è´¥';
                statusBadge.className = 'status-badge status-fail';
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            const resultDiv = document.getElementById('all-tests-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...';
            resultDiv.className = 'result info';

            try {
                await testBookmarkImport();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testErrorPageShortcut();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testMacOSShortcut();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testCategoryTags();

                let output = `ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼\n\n`;
                output += `ä¿®å¤æ€»ç»“:\n`;
                output += `1. âœ… ä¹¦ç­¾å¯¼å…¥åŠŸèƒ½ - æ·»åŠ æ‰¹é‡å¤„ç†å’Œé”™è¯¯æ¢å¤\n`;
                output += `2. âœ… é”™è¯¯é¡µé¢å¿«æ·é”® - æ‰©å±•ç‰¹æ®Šé¡µé¢æ£€æµ‹\n`;
                output += `3. âœ… ç»Ÿä¸€å¿«æ·é”® - æ‰€æœ‰å¹³å°éƒ½ä½¿ç”¨Ctrl+Q\n`;
                output += `4. âœ… åˆ†ç±»æ ‡ç­¾é€»è¾‘ - æ˜ç¡®ç±»å‹æ ‡è®°å’Œç¼“å­˜åˆ·æ–°\n\n`;
                output += `ğŸš€ QuickFinderæ‰©å±•ç°åœ¨åº”è¯¥èƒ½æ­£å¸¸å¤„ç†æ‰€æœ‰è¿™äº›åœºæ™¯ï¼`;

                resultDiv.className = 'result success';
                resultDiv.innerHTML = output;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `âŒ ç»¼åˆæµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }
    </script>
</body>
</html>
