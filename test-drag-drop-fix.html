<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹–æ”¾ä¿®å¤éªŒè¯å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .test-button {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.3);
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }

        .result.success {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid rgba(34, 197, 94, 0.6);
        }

        .result.error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.6);
        }

        .result.info {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid rgba(59, 130, 246, 0.6);
        }

        .fix-summary {
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .test-instructions {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âœ… æ‹–æ”¾ä¿®å¤éªŒè¯å·¥å…·</h1>
        <p>éªŒè¯ä»å³åˆ°å·¦æ‹–åŠ¨é—®é¢˜çš„ä¿®å¤æ•ˆæœ</p>
    </div>

    <!-- ä¿®å¤æ‘˜è¦ -->
    <div class="test-section">
        <h3>ğŸ”§ ä¿®å¤æ‘˜è¦</h3>
        <div class="fix-summary">
            <h4>å·²ä¿®å¤çš„é—®é¢˜ï¼š</h4>
            <p>âœ… <strong>ç´¢å¼•è®¡ç®—é€»è¾‘</strong>ï¼šä¿®å¤äº†ä»å³åˆ°å·¦æ‹–åŠ¨æ—¶çš„ç´¢å¼•è®¡ç®—é”™è¯¯</p>
            <p>âœ… <strong>è°ƒè¯•ä¿¡æ¯å¢å¼º</strong>ï¼šæ·»åŠ äº†è¯¦ç»†çš„æ‹–æ”¾è°ƒè¯•æ—¥å¿—</p>
            <p>âœ… <strong>æ’å…¥ä½ç½®åˆ¤æ–­</strong>ï¼šæ”¹è¿›äº†é¼ æ ‡ä½ç½®æ£€æµ‹å’Œæ’å…¥çº¿æ˜¾ç¤º</p>
            <p>âœ… <strong>åŒå‘æ‹–åŠ¨æ”¯æŒ</strong>ï¼šç¡®ä¿ä»å·¦åˆ°å³å’Œä»å³åˆ°å·¦éƒ½èƒ½æ­£å¸¸å·¥ä½œ</p>
        </div>
        
        <button class="test-button" onclick="showFixDetails()">æ˜¾ç¤ºä¿®å¤è¯¦æƒ…</button>
        <div id="fix-details" class="result" style="display:none;"></div>
    </div>

    <!-- æµ‹è¯•æŒ‡å— -->
    <div class="test-section">
        <h3>ğŸ§ª æµ‹è¯•æŒ‡å—</h3>
        <div class="test-instructions">
            <h4>å¦‚ä½•æµ‹è¯•ä¿®å¤æ•ˆæœï¼š</h4>
            <p>1. æ‰“å¼€ QuickFinder ä¹¦ç­¾ç®¡ç†ç•Œé¢</p>
            <p>2. ç¡®ä¿æœ‰å¤šä¸ªä¹¦ç­¾æˆ–æ–‡ä»¶å¤¹å¯ä»¥æ‹–åŠ¨</p>
            <p>3. æµ‹è¯•ä»¥ä¸‹æ‹–åŠ¨åœºæ™¯ï¼š</p>
            <ul>
                <li>ä»å·¦åˆ°å³æ‹–åŠ¨ï¼ˆåº”è¯¥ç»§ç»­æ­£å¸¸å·¥ä½œï¼‰</li>
                <li>ä»å³åˆ°å·¦æ‹–åŠ¨ï¼ˆç°åœ¨åº”è¯¥æ­£ç¡®å·¥ä½œï¼‰</li>
                <li>æ‹–åŠ¨åˆ°ç›®æ ‡é¡¹å‰é¢</li>
                <li>æ‹–åŠ¨åˆ°ç›®æ ‡é¡¹åé¢</li>
            </ul>
            <p>4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„è°ƒè¯•æ—¥å¿—</p>
            <p>5. éªŒè¯æœ€ç»ˆçš„ä¹¦ç­¾é¡ºåºæ˜¯å¦ç¬¦åˆé¢„æœŸ</p>
        </div>
        
        <button class="test-button" onclick="showTestScenarios()">æ˜¾ç¤ºæµ‹è¯•åœºæ™¯</button>
        <div id="test-scenarios" class="result" style="display:none;"></div>
    </div>

    <!-- è°ƒè¯•å·¥å…· -->
    <div class="test-section">
        <h3>ğŸ” è°ƒè¯•å·¥å…·</h3>
        <p>ä½¿ç”¨è¿™äº›å·¥å…·æ¥éªŒè¯ç´¢å¼•è®¡ç®—é€»è¾‘</p>
        
        <button class="test-button" onclick="testIndexCalculation()">æµ‹è¯•ç´¢å¼•è®¡ç®—</button>
        <button class="test-button" onclick="simulateDragScenarios()">æ¨¡æ‹Ÿæ‹–åŠ¨åœºæ™¯</button>
        <div id="debug-result" class="result" style="display:none;"></div>
    </div>

    <!-- é¢„æœŸç»“æœ -->
    <div class="test-section">
        <h3>ğŸ¯ é¢„æœŸç»“æœ</h3>
        <div class="test-instructions">
            <h4>ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š</h4>
            <p>âœ… ä»å³åˆ°å·¦æ‹–åŠ¨ä¸å†å¤±è´¥</p>
            <p>âœ… ä¹¦ç­¾è¢«æ”¾ç½®åˆ°å¯è§†åŒ–æŒ‡ç¤ºå™¨æ˜¾ç¤ºçš„æ­£ç¡®ä½ç½®</p>
            <p>âœ… æ‹–åŠ¨æ–¹å‘ä¸å½±å“æœ€ç»ˆç»“æœçš„å‡†ç¡®æ€§</p>
            <p>âœ… æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„æ‹–æ”¾è°ƒè¯•ä¿¡æ¯</p>
            <p>âœ… ä¹¦ç­¾é¡ºåºåœ¨UIå’ŒChromeä¹¦ç­¾APIä¸­éƒ½æ­£ç¡®ä¿ç•™</p>
        </div>
        
        <button class="test-button" onclick="showExpectedBehavior()">æ˜¾ç¤ºé¢„æœŸè¡Œä¸º</button>
        <div id="expected-result" class="result" style="display:none;"></div>
    </div>

    <script>
        // æ˜¾ç¤ºä¿®å¤è¯¦æƒ…
        function showFixDetails() {
            const resultDiv = document.getElementById('fix-details');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';

            const details = `ä¿®å¤è¯¦æƒ…
========

1. insertItemAtPosition å‡½æ•°ä¿®å¤ï¼š
   - æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
   - ä¿®å¤äº†ç´¢å¼•è®¡ç®—é€»è¾‘
   - æ”¹è¿›äº†åŒçº§ç§»åŠ¨æ—¶çš„ç´¢å¼•è°ƒæ•´

2. showDragInsertLine å‡½æ•°å¢å¼ºï¼š
   - æ·»åŠ äº†é¼ æ ‡ä½ç½®è°ƒè¯•ä¿¡æ¯
   - æ”¹è¿›äº†æ’å…¥ä½ç½®åˆ¤æ–­é€»è¾‘
   - å¢å¼ºäº†æ’å…¥çº¿æ˜¾ç¤ºçš„å‡†ç¡®æ€§

3. handleDrop å‡½æ•°æ”¹è¿›ï¼š
   - æ·»åŠ äº†å®Œæ•´çš„æ‹–æ”¾æµç¨‹è°ƒè¯•
   - æ”¹è¿›äº†é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

å…³é”®ä¿®å¤ç‚¹ï¼š
- ç´¢å¼•è®¡ç®—æ—¶æ­£ç¡®å¤„ç†ä»å³åˆ°å·¦çš„æ‹–åŠ¨
- åªåœ¨å¿…è¦æ—¶è°ƒæ•´ç´¢å¼•ï¼ˆé¿å…è¿‡åº¦è°ƒæ•´ï¼‰
- å¢åŠ è°ƒè¯•ä¿¡æ¯å¸®åŠ©å®šä½é—®é¢˜

ä¿®å¤å‰çš„é—®é¢˜ï¼š
âŒ ä»å³åˆ°å·¦æ‹–åŠ¨æ—¶ç´¢å¼•è®¡ç®—é”™è¯¯
âŒ ä¹¦ç­¾è¢«æ”¾åˆ°åˆ—è¡¨æœ«å°¾è€Œéé¢„æœŸä½ç½®
âŒ ç¼ºä¹è°ƒè¯•ä¿¡æ¯éš¾ä»¥å®šä½é—®é¢˜

ä¿®å¤åçš„æ”¹è¿›ï¼š
âœ… æ­£ç¡®è®¡ç®—æ‰€æœ‰æ–¹å‘çš„æ‹–åŠ¨ç´¢å¼•
âœ… ä¹¦ç­¾ç²¾ç¡®æ”¾ç½®åˆ°æŒ‡ç¤ºå™¨ä½ç½®
âœ… è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—å¸®åŠ©é—®é¢˜è¯Šæ–­`;

            resultDiv.innerHTML = details;
        }

        // æ˜¾ç¤ºæµ‹è¯•åœºæ™¯
        function showTestScenarios() {
            const resultDiv = document.getElementById('test-scenarios');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';

            const scenarios = `æµ‹è¯•åœºæ™¯
========

åœºæ™¯1ï¼šä»å·¦åˆ°å³æ‹–åŠ¨
- å°†ç¬¬1ä¸ªä¹¦ç­¾æ‹–åˆ°ç¬¬4ä¸ªä¹¦ç­¾åé¢
- é¢„æœŸï¼šç¬¬1ä¸ªä¹¦ç­¾ç§»åŠ¨åˆ°ç¬¬4ä¸ªä½ç½®
- éªŒè¯ï¼šé¡ºåºå˜ä¸º [2, 3, 4, 1, 5, ...]

åœºæ™¯2ï¼šä»å³åˆ°å·¦æ‹–åŠ¨ï¼ˆä¸»è¦ä¿®å¤ç›®æ ‡ï¼‰
- å°†ç¬¬5ä¸ªä¹¦ç­¾æ‹–åˆ°ç¬¬2ä¸ªä¹¦ç­¾å‰é¢
- é¢„æœŸï¼šç¬¬5ä¸ªä¹¦ç­¾ç§»åŠ¨åˆ°ç¬¬2ä¸ªä½ç½®
- éªŒè¯ï¼šé¡ºåºå˜ä¸º [1, 5, 2, 3, 4, ...]

åœºæ™¯3ï¼šæ‹–åŠ¨åˆ°å‰é¢
- å°†ä»»æ„ä¹¦ç­¾æ‹–åˆ°ç›®æ ‡ä¹¦ç­¾çš„å·¦åŠéƒ¨åˆ†
- é¢„æœŸï¼šæ’å…¥çº¿æ˜¾ç¤ºåœ¨ç›®æ ‡ä¹¦ç­¾å·¦ä¾§
- éªŒè¯ï¼šä¹¦ç­¾æ’å…¥åˆ°ç›®æ ‡ä¹¦ç­¾å‰é¢

åœºæ™¯4ï¼šæ‹–åŠ¨åˆ°åé¢
- å°†ä»»æ„ä¹¦ç­¾æ‹–åˆ°ç›®æ ‡ä¹¦ç­¾çš„å³åŠéƒ¨åˆ†
- é¢„æœŸï¼šæ’å…¥çº¿æ˜¾ç¤ºåœ¨ç›®æ ‡ä¹¦ç­¾å³ä¾§
- éªŒè¯ï¼šä¹¦ç­¾æ’å…¥åˆ°ç›®æ ‡ä¹¦ç­¾åé¢

åœºæ™¯5ï¼šæ–‡ä»¶å¤¹æ‹–åŠ¨
- æµ‹è¯•æ–‡ä»¶å¤¹çš„æ‹–åŠ¨é‡æ’åº
- éªŒè¯ï¼šæ–‡ä»¶å¤¹ä¹Ÿèƒ½æ­£ç¡®é‡æ’åº

è°ƒè¯•æ£€æŸ¥ç‚¹ï¼š
1. æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†çš„æ‹–æ”¾æ—¥å¿—
2. æ’å…¥çº¿æ˜¯å¦æ˜¾ç¤ºåœ¨æ­£ç¡®ä½ç½®
3. æœ€ç»ˆä¹¦ç­¾é¡ºåºæ˜¯å¦ç¬¦åˆé¢„æœŸ
4. æ˜¯å¦æœ‰ä»»ä½•JavaScripté”™è¯¯`;

            resultDiv.innerHTML = scenarios;
        }

        // æµ‹è¯•ç´¢å¼•è®¡ç®—
        function testIndexCalculation() {
            const resultDiv = document.getElementById('debug-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';

            const testCases = [
                {
                    name: "ä»å·¦åˆ°å³æ‹–åŠ¨åˆ°åé¢",
                    draggedIndex: 0,
                    targetIndex: 3,
                    insertBefore: false,
                    expected: 3
                },
                {
                    name: "ä»å³åˆ°å·¦æ‹–åŠ¨åˆ°å‰é¢",
                    draggedIndex: 4,
                    targetIndex: 1,
                    insertBefore: true,
                    expected: 1
                },
                {
                    name: "ä»å³åˆ°å·¦æ‹–åŠ¨åˆ°åé¢",
                    draggedIndex: 4,
                    targetIndex: 1,
                    insertBefore: false,
                    expected: 2
                },
                {
                    name: "ä»å·¦åˆ°å³æ‹–åŠ¨åˆ°å‰é¢",
                    draggedIndex: 0,
                    targetIndex: 3,
                    insertBefore: true,
                    expected: 2
                }
            ];

            let result = `ç´¢å¼•è®¡ç®—æµ‹è¯•\n`;
            result += `============\n\n`;

            testCases.forEach((testCase, index) => {
                result += `æµ‹è¯• ${index + 1}: ${testCase.name}\n`;
                result += `æ‹–åŠ¨é¡¹ç´¢å¼•: ${testCase.draggedIndex}\n`;
                result += `ç›®æ ‡é¡¹ç´¢å¼•: ${testCase.targetIndex}\n`;
                result += `æ’å…¥ä½ç½®: ${testCase.insertBefore ? 'å‰é¢' : 'åé¢'}\n`;

                // æ¨¡æ‹Ÿä¿®å¤åçš„è®¡ç®—é€»è¾‘
                let targetIndex = testCase.targetIndex;
                if (!testCase.insertBefore) {
                    targetIndex += 1;
                }
                if (testCase.draggedIndex < targetIndex) {
                    targetIndex -= 1;
                }

                result += `è®¡ç®—ç»“æœ: ${targetIndex}\n`;
                result += `æœŸæœ›ç»“æœ: ${testCase.expected}\n`;
                result += `æµ‹è¯•ç»“æœ: ${targetIndex === testCase.expected ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
                result += `${'='.repeat(40)}\n\n`;
            });

            resultDiv.innerHTML = result;
        }

        // æ¨¡æ‹Ÿæ‹–åŠ¨åœºæ™¯
        function simulateDragScenarios() {
            const resultDiv = document.getElementById('debug-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';

            const simulation = `æ‹–åŠ¨åœºæ™¯æ¨¡æ‹Ÿ
============

åˆå§‹é¡ºåº: [A, B, C, D, E]

åœºæ™¯1ï¼šA æ‹–åˆ° D åé¢
- æ‹–åŠ¨é¡¹: A (ç´¢å¼•0)
- ç›®æ ‡é¡¹: D (ç´¢å¼•3)
- æ’å…¥ä½ç½®: åé¢
- è®¡ç®—è¿‡ç¨‹:
  1. ç›®æ ‡ç´¢å¼• = 3
  2. æ’å…¥åˆ°åé¢ï¼Œç´¢å¼•+1 = 4
  3. æ‹–åŠ¨é¡¹åœ¨å‰é¢ï¼Œç´¢å¼•-1 = 3
- ç»“æœé¡ºåº: [B, C, D, A, E] âœ…

åœºæ™¯2ï¼šE æ‹–åˆ° B å‰é¢ï¼ˆä¿®å¤é‡ç‚¹ï¼‰
- æ‹–åŠ¨é¡¹: E (ç´¢å¼•4)
- ç›®æ ‡é¡¹: B (ç´¢å¼•1)
- æ’å…¥ä½ç½®: å‰é¢
- è®¡ç®—è¿‡ç¨‹:
  1. ç›®æ ‡ç´¢å¼• = 1
  2. æ’å…¥åˆ°å‰é¢ï¼Œç´¢å¼•ä¸å˜ = 1
  3. æ‹–åŠ¨é¡¹åœ¨åé¢ï¼Œä¸è°ƒæ•´ = 1
- ç»“æœé¡ºåº: [A, E, B, C, D] âœ…

åœºæ™¯3ï¼šE æ‹–åˆ° B åé¢
- æ‹–åŠ¨é¡¹: E (ç´¢å¼•4)
- ç›®æ ‡é¡¹: B (ç´¢å¼•1)
- æ’å…¥ä½ç½®: åé¢
- è®¡ç®—è¿‡ç¨‹:
  1. ç›®æ ‡ç´¢å¼• = 1
  2. æ’å…¥åˆ°åé¢ï¼Œç´¢å¼•+1 = 2
  3. æ‹–åŠ¨é¡¹åœ¨åé¢ï¼Œä¸è°ƒæ•´ = 2
- ç»“æœé¡ºåº: [A, B, E, C, D] âœ…

æ‰€æœ‰åœºæ™¯éƒ½åº”è¯¥æ­£ç¡®å·¥ä½œï¼`;

            resultDiv.innerHTML = simulation;
        }

        // æ˜¾ç¤ºé¢„æœŸè¡Œä¸º
        function showExpectedBehavior() {
            const resultDiv = document.getElementById('expected-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';

            const behavior = `é¢„æœŸè¡Œä¸ºè¯¦ç»†è¯´æ˜
================

1. æ‹–åŠ¨å¼€å§‹æ—¶ï¼š
   âœ… è¢«æ‹–åŠ¨é¡¹å˜ä¸ºåŠé€æ˜
   âœ… é¼ æ ‡æŒ‡é’ˆå˜ä¸ºç§»åŠ¨çŠ¶æ€

2. æ‹–åŠ¨è¿‡ç¨‹ä¸­ï¼š
   âœ… æ’å…¥çº¿å‡†ç¡®æ˜¾ç¤ºåœ¨é¼ æ ‡ä½ç½®å¯¹åº”çš„æ’å…¥ç‚¹
   âœ… ä»å·¦åˆ°å³å’Œä»å³åˆ°å·¦éƒ½æ˜¾ç¤ºæ­£ç¡®çš„æ’å…¥çº¿
   âœ… æ’å…¥çº¿åœ¨ç›®æ ‡é¡¹å·¦ä¾§ï¼ˆå‰é¢ï¼‰æˆ–å³ä¾§ï¼ˆåé¢ï¼‰

3. æ”¾ç½®æ—¶ï¼š
   âœ… ä¹¦ç­¾ç²¾ç¡®ç§»åŠ¨åˆ°æ’å…¥çº¿æŒ‡ç¤ºçš„ä½ç½®
   âœ… ä¸ä¼šå‡ºç°"ç§»åŠ¨åˆ°åˆ—è¡¨æœ«å°¾"çš„é”™è¯¯
   âœ… ä¹¦ç­¾é¡ºåºç«‹å³æ›´æ–°å¹¶ä¿å­˜

4. æ§åˆ¶å°æ—¥å¿—ï¼š
   âœ… æ˜¾ç¤ºæ‹–åŠ¨é¡¹å’Œç›®æ ‡é¡¹ä¿¡æ¯
   âœ… æ˜¾ç¤ºé¼ æ ‡ä½ç½®å’Œæ’å…¥ä½ç½®åˆ¤æ–­
   âœ… æ˜¾ç¤ºç´¢å¼•è®¡ç®—è¿‡ç¨‹
   âœ… æ˜¾ç¤ºæœ€ç»ˆç§»åŠ¨ç»“æœ

5. ç”¨æˆ·ä½“éªŒï¼š
   âœ… æ‹–åŠ¨æ“ä½œæµç•…æ— å¡é¡¿
   âœ… è§†è§‰åé¦ˆæ¸…æ™°å‡†ç¡®
   âœ… æ“ä½œç»“æœç¬¦åˆç›´è§‰é¢„æœŸ
   âœ… æ”¯æŒæ’¤é”€æ“ä½œï¼ˆé€šè¿‡æµè§ˆå™¨ä¹¦ç­¾ç®¡ç†ï¼‰

å¦‚æœçœ‹åˆ°ä»¥ä¸Šæ‰€æœ‰è¡Œä¸ºï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼`;

            resultDiv.innerHTML = behavior;
        }
    </script>
</body>
</html>
